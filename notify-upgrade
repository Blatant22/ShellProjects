#!/bin/bash

#----------------------------------------------------------------------------------
# Project Name      - notify-upgrade
# Started On        - Sun 17 Sep 16:07:59 BST 2017
# Last Change       - Sun 17 Sep 16:32:52 BST 2017
# Author E-Mail     - terminalforlife@yahoo.com
# Author GitHub     - https://github.com/terminalforlife
#----------------------------------------------------------------------------------

#TODO - Actually made this ages ago now; finally updating it.

ERR(){ echo "ERROR: $1" 1>&2; }

[ $UID -eq 0 ] && XERR "Root access isn't required."

DEPCOUNT=0
for DEP in /usr/bin/{lsb_release,paplay,apt-get,espeak,cut} /bin/{grep,sleep}
{
	if ! type -P "$DEP" &> /dev/null
	then
		ERR "Dependency '$DEP' not met."
		let DEPCOUNT++
	fi
}

[ $DEPCOUNT -eq 0 ] || exit 1

LSB_RELEASE=`/usr/bin/lsb_release -is`
case "${LSB_RELEASE:-EMPTY}"
in
	Ubuntu|Debian|LinuxMint)
		;;
	*)
		XERR "Unsupported LSB/Distro detected."
esac

NOTIFY()
{
	/usr/bin/paplay $HOME/dong.wav
	/bin/sleep 0.03
	/usr/bin/espeak -p 0 "$1"
}

while :
do
	SIM=$(
		/usr/bin/apt-get upgrade -ys\
			| /bin/grep "[0-9].*, [0-9].*, [0-9].* [0-9].*\."
	)

	UPGRADE=$(echo "$SIM" | /usr/bin/cut -d " " -f 1)
	[ "$UPGRADE" -gt 0 ] && NOTIFY "Upgrades available."

	NEWLY_INSTALL=$(echo "$SIM" | /usr/bin/cut -d " " -f 4)
	[ "$NEWLY_INSTALL" -gt 0 ] && NOTIFY "New packages available."

	REMOVE=$(echo "$SIM" | /usr/bin/cut -d " " -f 8)
	[ "$REMOVE" -gt 0 ] && NOTIFY "Packages up for removal."

	NOT_UPGRADE=$(echo "$SIM" | /usr/bin/cut -d " " -f 8)
	[ "$NOT_UPGRADE" -gt 0 ] && NOTIFY "Dist-upgrade is available."

	sleep 30m
done
